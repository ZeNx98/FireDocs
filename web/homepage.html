<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireDocs</title>
    <script>
        window.onerror = function (message, source, lineno, colno, error) {
            alert('Error: ' + message + '\nSource: ' + source + '\nLine: ' + lineno);
        };
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --bg-color: #0F0F0F;
            --surface-color: #1A1A1A;
            --surface-hover: #262626;

            /* Orange/Fire Theme */
            --primary-gradient: linear-gradient(135deg, #FCCA80 0%, #FF893E 33%, #FC6660 66%, #ED452F 100%);
            --primary-color: #FF893E;
            --primary-glow: rgba(255, 137, 62, 0.4);

            --text-primary: #FFFFFF;
            --text-secondary: #AAAAAA;

            --border-radius: 16px;
            --transition: all 0.2s ease;
            /* Faster, simpler transition */
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            transition: var(--transition);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
            box-shadow: 0 0 10px var(--primary-glow);
        }

        ::-webkit-scrollbar-corner {
            background: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 137, 62, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(252, 202, 128, 0.05) 0%, transparent 40%);
        }

        /* Header */
        header {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 1rem;
        }

        .header-controls {
            position: absolute;
            top: 2rem;
            right: 2rem;
            display: flex;
            gap: 1rem;
        }

        .icon-btn {
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .brand {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            cursor: default;
        }

        .brand-icon {
            width: 80px;
            height: 80px;
            filter: drop-shadow(0 0 25px rgba(255, 137, 62, 0.4));
        }

        .brand-text {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.03em;
        }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 1rem 2rem;
            gap: 3rem;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            box-sizing: border-box;
            overflow-y: auto;
        }

        /* Hero / Drop Zone */
        .drop-zone {
            width: 100%;
            max-width: 700px;
            height: 300px;
            flex-shrink: 0;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(12px);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .drop-zone:hover,
        .drop-zone.drag-over {
            border-color: var(--primary-color);
            background: rgba(30, 30, 30, 0.8);
            box-shadow: 0 0 40px rgba(255, 137, 62, 0.2);
        }

        .drop-content {
            text-align: center;
            pointer-events: none;
            z-index: 2;
        }

        .drop-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            background: var(--primary-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.2));
        }

        .drop-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .drop-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .btn-browse {
            margin-top: 2rem;
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-family: inherit;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 20px rgba(255, 137, 62, 0.3);
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }

        .btn-browse:hover {
            opacity: 0.9;
            box-shadow: 0 12px 25px rgba(255, 137, 62, 0.4);
        }

        /* Recents */
        .recents-container {
            width: 100%;
            max-width: 700px;
            margin-bottom: 2rem;
        }

        .recents-header {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .recents-title {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .recents-title::after {
            content: '';
            height: 1px;
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-clear-all {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: var(--transition);
            margin-left: 10px;
        }

        .btn-clear-all:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary-color);
        }

        .recents-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .recent-card {
            background: var(--surface-color);
            padding: 1.2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }

        .recent-card:hover {
            background: var(--surface-hover);
            border-color: rgba(255, 94, 98, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .recent-card:hover .btn-delete-recent {
            opacity: 1;
        }

        .recent-icon {
            width: 44px;
            height: 44px;
            background: rgba(255, 94, 98, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }

        .recent-icon svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .recent-info {
            flex: 1;
            overflow: hidden;
        }

        .recent-name {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 0.3rem;
            color: #fff;
        }

        .recent-path {
            font-size: 0.75rem;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Delete button logic */
        .btn-delete-recent {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0;
        }

        .btn-delete-recent:hover {
            background: #ED452F;
            color: white;
        }

        .empty-state {
            text-align: center;
            color: var(--text-secondary);
            padding: 2rem;
            font-style: italic;
            opacity: 0.7;
        }

        /* Footer */
        footer {
            padding: 1.5rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            width: 100%;
            box-sizing: border-box;
        }

        .credits {
            cursor: pointer;
            transition: color 0.2s;
            display: inline-block;
        }

        .credits:hover {
            color: var(--primary-color);
        }

        .heart {
            color: #ED452F;
            display: inline-block;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .modal-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal {
            background: var(--surface-color);
            padding: 2.5rem;
            border-radius: 24px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transform: translateY(20px);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal h2 {
            margin-top: 0;
            color: var(--text-primary);
        }

        .modal p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .btn-close {
            margin-top: 1.5rem;
            background: var(--surface-hover);
            border: none;
            color: var(--text-primary);
            padding: 0.8rem 2rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-close:hover {
            background: #333;
        }

        /* Settings CSS */
        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 1.5rem 0;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            text-align: left;
        }

        .settings-label {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface-hover);
            transition: .3s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-primary);
            transition: .3s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-image: var(--primary-gradient);
            box-shadow: 0 0 12px var(--primary-glow);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        .settings-select {
            background: var(--surface-hover);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.9rem;
            outline: none;
            cursor: pointer;
        }

        .settings-select:focus {
            border-color: var(--primary-color);
        }

        @media (max-height: 800px),
        (max-height: 800px) {
            header {
                padding: 1rem;
                margin-bottom: 0.5rem;
            }

            .header-controls {
                top: 1rem;
                right: 1rem;
            }

            .brand-icon {
                width: 60px;
                height: 60px;
            }

            .brand-text {
                font-size: 2rem;
            }

            main {
                gap: 1.5rem;
                padding: 0.5rem 2rem;
            }

            .drop-zone {
                height: 220px;
                border-radius: 24px;
            }

            .drop-icon {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }

            .drop-icon svg {
                width: 48px;
                height: 48px;
            }

            .drop-title {
                font-size: 1.25rem;
            }

            .btn-browse {
                margin-top: 1.5rem;
                padding: 0.8rem 2rem;
            }

            .recents-container {
                margin-bottom: 1rem;
            }

            .recent-card {
                padding: 0.8rem;
            }

            .recent-icon {
                width: 36px;
                height: 36px;
            }
        }
    </style>
</head>

<body>
    <header data-tauri-drag-region>
        <div class="header-controls">
            <button class="icon-btn" id="settingsBtn" title="Settings">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </button>
            <button class="icon-btn" id="infoBtn" title="About">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            </button>
        </div>
        <div class="brand">
            <img src="icon.png" alt="FireDocs Logo" class="brand-icon">
            <div class="brand-text">FireDocs</div>
        </div>
    </header>

    <main>
        <div class="drop-zone" id="dropZone">
            <div class="drop-content">
                <div class="drop-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="url(#gradient)"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#FCCA80" />
                                <stop offset="33%" style="stop-color:#FF893E" />
                                <stop offset="66%" style="stop-color:#FC6660" />
                                <stop offset="100%" style="stop-color:#ED452F" />
                            </linearGradient>
                        </defs>
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                </div>
                <div class="drop-title" data-i18n="dropTitle">Drop your PDF here</div>
                <div class="drop-subtitle" data-i18n="dropSubtitle">or select a file to start reading</div>
                <button class="btn-browse" id="openBtn" data-i18n="browseFiles">Browse Files</button>
            </div>
        </div>

        <div class="recents-container">
            <div class="recents-header">
                <div class="recents-title" data-i18n="continueReading">Continue Reading</div>
                <button class="btn-clear-all" id="clearRecentsBtn" title="Clear Recent Files" data-i18n="clearAll">Clear
                    All</button>
            </div>
            <div class="recents-list" id="recentsList">
                <div class="empty-state" data-i18n="noRecents">No recent files found</div>
            </div>
        </div>
    </main>

    <footer>
        <div class="credits" id="creditsLink">
            <span data-i18n="madeWith">Made with</span> <span class="heart">❤</span> <span data-i18n="byZen">by
                ZeNx98</span>
        </div>
    </footer>

    <!-- About Modal -->
    <div class="modal-overlay" id="aboutModal">
        <div class="modal">
            <h2>FireDocs</h2>
            <p>Version 2.1.0</p>
            <p data-i18n="aboutDescription">A minimalist, blazing fast PDF viewer built with Tauri.</p>
            <button class="btn-close" id="closeModal" data-i18n="close">Close</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h2 data-i18n="settings">Settings</h2>
            <div class="settings-row">
                <span class="settings-label" data-i18n="language">Language</span>
                <select class="settings-select" id="languageSelect">
                    <option value="en">English</option>
                    <option value="ar">العربية (Arabic)</option>
                </select>
            </div>
            <div class="settings-row">
                <span class="settings-label" data-i18n="hideTitleBar">Hide System Title Bar</span>
                <label class="switch">
                    <input type="checkbox" id="hideDecorationsToggle">
                    <span class="slider"></span>
                </label>
            </div>
            <button class="btn-close" id="closeSettingsModal" data-i18n="close">Close</button>
        </div>
    </div>

    <script>
        // Electron Integration
        const invoke = window.electron?.invoke || ((cmd, args) => { console.log('Mock/Browser invoke:', cmd, args); return Promise.resolve(null); });

        const dropZone = document.getElementById('dropZone');
        const openBtn = document.getElementById('openBtn');
        const recentsList = document.getElementById('recentsList');
        const clearRecentsBtn = document.getElementById('clearRecentsBtn');
        const infoBtn = document.getElementById('infoBtn');
        const settingsBtn = document.getElementById('settingsBtn');
        const aboutModal = document.getElementById('aboutModal');
        const settingsModal = document.getElementById('settingsModal');
        const closeModal = document.getElementById('closeModal');
        const closeSettingsModal = document.getElementById('closeSettingsModal');
        const creditsLink = document.getElementById('creditsLink');
        const hideDecorationsToggle = document.getElementById('hideDecorationsToggle');

        const languageSelect = document.getElementById('languageSelect');

        let recents = [];

        const translations = {
            en: {
                dropTitle: "Drop your PDF here",
                dropSubtitle: "or select a file to start reading",
                browseFiles: "Browse Files",
                continueReading: "Continue Reading",
                clearAll: "Clear All",
                noRecents: "No recent files found",
                madeWith: "Made with",
                byZen: "by ZeNx98",
                aboutDescription: "A minimalist, blazing fast PDF viewer built with Electron.",
                close: "Close",
                settings: "Settings",
                language: "Language",
                hideTitleBar: "Hide System Title Bar",
                confirmClear: "Clear all recent files?",
                confirmRemove: "Remove this file from recents?"
            },
            ar: {
                dropTitle: "أفلت ملف PDF هنا",
                dropSubtitle: "أو اختر ملفاً لبدء القراءة",
                browseFiles: "تصفح الملفات",
                continueReading: "متابعة القراءة",
                clearAll: "مسح الكل",
                noRecents: "لا توجد ملفات حديثة",
                madeWith: "صنع بـ",
                byZen: "بواسطة ZeNx98",
                aboutDescription: "عارض PDF بسيط وسريع للغاية مبني بـ Electron.",
                close: "إغلاق",
                settings: "الإعدادات",
                language: "اللغة",
                hideTitleBar: "إخفاء شريط العنوان",
                confirmClear: "هل أنت متأكد من مسح جميع الملفات الحديثة؟",
                confirmRemove: "هل تريد إزالة هذا الملف من القائمة؟"
            }
        };

        async function init() {
            loadRecents();
            // renderRecents() is called inside setLanguage because noRecents text needs translation
            loadSettings();
            setupListeners();
        }

        function loadSettings() {
            const hideDecorations = localStorage.getItem('fireDocs_hideDecorations') === 'true';
            hideDecorationsToggle.checked = hideDecorations;
            if (hideDecorations) {
                applyDecorations(false);
            }

            const storedLang = localStorage.getItem('fireDocs_language') || 'en';
            languageSelect.value = storedLang;
            setLanguage(storedLang);
        }

        function saveSettings() {
            localStorage.setItem('fireDocs_hideDecorations', hideDecorationsToggle.checked);
        }

        function setLanguage(lang) {
            const t = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });

            // Update Direction
            if (lang === 'ar') {
                document.body.dir = 'rtl';
            } else {
                document.body.dir = 'ltr';
            }

            // Save preference
            localStorage.setItem('fireDoc_language', lang);

            // Re-render recents to update "No recent files found" if needed
            renderRecents();
        }


        async function applyDecorations(show) {
            // Electron: Toggle menu bar visibility via main process
            if (window.electron) {
                try {
                    await window.electron.invoke('set_titlebar_visible', show);
                } catch (e) {
                    console.error('Failed to toggle titlebar:', e);
                }
            }
        }

        async function openPdf(path) {
            try {
                if (!window.electron) {
                    alert('This feature requires the app to be running in Electron.');
                    return;
                }

                addToRecents(path);

                const viewerUrl = `pdfjs/web/viewer.html?file=&pdfPath=${encodeURIComponent(path)}`;
                window.location.href = viewerUrl;
            } catch (err) {
                console.error('Failed to open PDF:', err);
                alert('Failed to open PDF: ' + err);
            }
        }

        function addToRecents(path) {
            recents = recents.filter(r => r.path !== path);
            let name = path.split(/[\\/]/).pop();
            recents.unshift({ name, path, date: Date.now() });
            if (recents.length > 6) recents.pop();
            saveRecents();
        }

        function loadRecents() {
            try {
                const stored = localStorage.getItem('fireDocRecents');
                if (stored) recents = JSON.parse(stored);
            } catch (e) {
                console.error(e);
            }
        }

        function saveRecents() {
            localStorage.setItem('fireDocRecents', JSON.stringify(recents));
        }

        function clearRecents() {
            const currentLang = languageSelect.value;
            const msg = translations[currentLang].confirmClear;
            if (confirm(msg)) {
                recents = [];
                saveRecents();
                renderRecents();
            }
        }

        function removeRecent(index, event) {
            event.stopPropagation(); // Prevent opening the file
            const currentLang = languageSelect.value;
            const msg = translations[currentLang].confirmRemove;
            if (confirm(msg)) {
                recents.splice(index, 1);
                saveRecents();
                renderRecents();
            }
        }

        // Expose to window for the onclick handler in string template
        window.removeRecent = removeRecent;
        window.openPdf = openPdf;

        function renderRecents() {
            const currentLang = languageSelect.value;
            if (recents.length === 0) {
                recentsList.innerHTML = `<div class="empty-state" data-i18n="noRecents">${translations[currentLang].noRecents}</div>`;
                clearRecentsBtn.style.display = 'none';
                return;
            }
            clearRecentsBtn.style.display = 'block';

            recentsList.innerHTML = '';
            recents.forEach((file, index) => {
                const card = document.createElement('div');
                card.className = 'recent-card';

                // Click to open
                card.addEventListener('click', () => openPdf(file.path));

                // Icon
                const iconDiv = document.createElement('div');
                iconDiv.className = 'recent-icon';
                iconDiv.innerHTML = `
                    <svg viewBox="0 0 24 24" width="24" height="24">
                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" fill="currentColor"/>
                    </svg>`;
                card.appendChild(iconDiv);

                // Info
                const infoDiv = document.createElement('div');
                infoDiv.className = 'recent-info';

                const nameDiv = document.createElement('div');
                nameDiv.className = 'recent-name';
                nameDiv.textContent = file.name;
                infoDiv.appendChild(nameDiv);

                const pathDiv = document.createElement('div');
                pathDiv.className = 'recent-path';
                pathDiv.textContent = file.path;
                infoDiv.appendChild(pathDiv);

                card.appendChild(infoDiv);

                // Delete Button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn-delete-recent';
                deleteBtn.title = 'Remove';
                deleteBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>`;

                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    removeRecent(index, e);
                });

                card.appendChild(deleteBtn);
                recentsList.appendChild(card);
            });
        }

        async function handleOpenClick() {
            try {
                const selectedPath = await invoke('select_pdf');
                if (selectedPath) openPdf(selectedPath);
            } catch (e) {
                console.error(e);
            }
        }

        function setupListeners() {
            hideDecorationsToggle.addEventListener('change', () => {
                const isHidden = hideDecorationsToggle.checked;
                applyDecorations(!isHidden);
                saveSettings(); // This saves 'true' if checked (hidden)
            });

            openBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                handleOpenClick();
            });

            dropZone.addEventListener('click', () => handleOpenClick());

            clearRecentsBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                clearRecents();
            });

            creditsLink.addEventListener('click', () => {
                const url = 'https://github.com/ZeNx98';
                window.open(url, '_blank');
            });

            // Modals
            infoBtn.addEventListener('click', () => aboutModal.classList.add('active'));
            closeModal.addEventListener('click', () => aboutModal.classList.remove('active'));
            aboutModal.addEventListener('click', (e) => {
                if (e.target === aboutModal) aboutModal.classList.remove('active');
            });

            settingsBtn.addEventListener('click', () => settingsModal.classList.add('active'));
            closeSettingsModal.addEventListener('click', () => settingsModal.classList.remove('active'));
            settingsModal.addEventListener('click', (e) => {
                if (e.target === settingsModal) settingsModal.classList.remove('active');
            });

            languageSelect.addEventListener('change', (e) => {
                setLanguage(e.target.value);
            });

            hideDecorationsToggle.addEventListener('change', () => {
                saveSettings();
                const hide = hideDecorationsToggle.checked;
                applyDecorations(!hide);
            });

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');

                if (e.dataTransfer && e.dataTransfer.files.length > 0) {
                    const file = e.dataTransfer.files[0];
                    // Electron exposes 'path' property on File objects
                    if (file.path && file.path.toLowerCase().endsWith('.pdf')) {
                        openPdf(file.path);
                    } else {
                        alert('Please drop a PDF file.');
                    }
                }
            });

            if (window.__TAURI__) {
                listen('tauri://file-drop', event => {
                    const paths = event.payload;
                    if (paths && paths.length > 0) {
                        const path = paths[0];
                        if (path.toLowerCase().endsWith('.pdf')) {
                            openPdf(path);
                        } else {
                            alert('Please drop a PDF file.');
                        }
                    }
                });
            }
        }

        init();
    </script>
</body>

</html>